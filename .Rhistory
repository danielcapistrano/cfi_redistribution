treat_spec = 'dsp_period',
time_windows = c('full', 20, 15)
) |>
filter(term != '(Intercept)' & p.value < 0.5)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 20, 15)
) |>
filter(term != '(Intercept)' & p.value < 0.5)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 20, 15)
) |>  filter(term != '(Intercept)' & p.value < 0.5)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 20, 15)
) |>  filter(term != '(Intercept)' & p.value < 0.05)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 20, 15, 7)
) |>  filter(term != '(Intercept)' & p.value < 0.05)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 20, 10, 7)
) |>  filter(term != '(Intercept)' & p.value < 0.05)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 20, 15, 7)
) |>  filter(term != '(Intercept)' & p.value < 0.05)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 15, 7)
) |>  filter(term != '(Intercept)' & p.value < 0.05)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 15, 7)
) |>  filter(term != '(Intercept)' & p.value < 0.05)
get_wt_model <- function(df, outcome, treat_spec, time_window = NULL){
df_dsp <-
df |>
filter(
cntry == "IE", essround == 8,
ess_day != '2017-04-17',
news == 'Yes',
!is.na(sblazy),
!is.na(sbprvpv),
!is.na(mnactic),
if(!is.null(time_window)){abs(dsp_daysafter) <= time_window} else TRUE
)
wt_dsp <- weightit(dsp_period ~ factor(gndr) + agea + factor(mnactic),
data = df_dsp,
estimand = "ATE",
method = "ebal")
m_test <- glm_weightit(
formula = as.formula(paste0(outcome, " ~ ", treat_spec)),
family = 'quasibinomial', weightit = wt_dsp,  data = df_dsp
)
return(m_test)
}
get_wt_plot <- function(df, outcomes, treat_spec, time_windows){
df_out <-
map_dfr(outcomes, function(x){
map_dfr(time_windows, function(y){
broom::tidy(get_wt_model(df, outcome = x, treat_spec = treat_spec, time_window = y)) |>
mutate(variable = x, period = y)
})
})
return(df_out)
}
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 15, 7)
) |>  filter(term != '(Intercept)' & p.value < 0.05)
get_wt_model <- function(df, outcome, treat_spec, time_window = NULL){
df_dsp <-
df |>
filter(
cntry == "IE", essround == 8,
ess_day != '2017-04-17',
news == 'Yes',
!is.na(sblazy),
!is.na(sbprvpv),
!is.na(mnactic),
if(!is.null(time_window)){abs(dsp_daysafter) <= time_window} else TRUE
)
wt_dsp <- weightit(dsp_period ~ factor(gndr) + age_group + factor(mnactic),
data = df_dsp,
estimand = "ATE",
method = "ebal")
m_test <- glm_weightit(
formula = as.formula(paste0(outcome, " ~ ", treat_spec)),
family = 'quasibinomial', weightit = wt_dsp,  data = df_dsp
)
return(m_test)
}
get_wt_plot <- function(df, outcomes, treat_spec, time_windows){
df_out <-
map_dfr(outcomes, function(x){
map_dfr(time_windows, function(y){
broom::tidy(get_wt_model(df, outcome = x, treat_spec = treat_spec, time_window = y)) |>
mutate(variable = x, period = y)
})
})
return(df_out)
}
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 15, 7)
) |>  filter(term != '(Intercept)' & p.value < 0.05)
get_wt_model <- function(df, outcome, treat_spec, time_window = NULL){
df_dsp <-
df |>
filter(
cntry == "IE", essround == 8,
ess_day != '2017-04-17',
news == 'Yes',
!is.na(sblazy),
!is.na(sbprvpv),
!is.na(mnactic),
if(!is.null(time_window)){abs(dsp_daysafter) <= time_window} else TRUE
)
wt_dsp <- weightit(dsp_period ~ vars_indo[vars_indo != 'as_factor(essround)'],
data = df_dsp,
estimand = "ATE",
method = "ebal")
m_test <- glm_weightit(
formula = as.formula(paste0(outcome, " ~ ", treat_spec)),
family = 'quasibinomial', weightit = wt_dsp,  data = df_dsp
)
return(m_test)
}
get_wt_plot <- function(df, outcomes, treat_spec, time_windows){
df_out <-
map_dfr(outcomes, function(x){
map_dfr(time_windows, function(y){
broom::tidy(get_wt_model(df, outcome = x, treat_spec = treat_spec, time_window = y)) |>
mutate(variable = x, period = y)
})
})
return(df_out)
}
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 15, 7)
) |>  filter(term != '(Intercept)' & p.value < 0.05)
get_wt_model <- function(df, outcome, treat_spec, time_window = NULL){
df_dsp <-
df |>
filter(
cntry == "IE", essround == 8,
ess_day != '2017-04-17',
#news == 'Yes',
!is.na(sblazy),
!is.na(sbprvpv),
!is.na(mnactic),
if(!is.null(time_window)){abs(dsp_daysafter) <= time_window} else TRUE
)
wt_dsp <- weightit(dsp_period ~ factor(gndr) + age_group + factor(mnactic),
data = df_dsp,
estimand = "ATE",
method = "ebal")
m_test <- glm_weightit(
formula = as.formula(paste0(outcome, " ~ ", treat_spec)),
family = 'quasibinomial', weightit = wt_dsp,  data = df_dsp
)
return(m_test)
}
get_wt_plot <- function(df, outcomes, treat_spec, time_windows){
df_out <-
map_dfr(outcomes, function(x){
map_dfr(time_windows, function(y){
broom::tidy(get_wt_model(df, outcome = x, treat_spec = treat_spec, time_window = y)) |>
mutate(variable = x, period = y)
})
})
return(df_out)
}
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 15, 7)
) |>  filter(term != '(Intercept)' & p.value < 0.05)
get_wt_model <- function(df, outcome, treat_spec, time_window = NULL){
df_dsp <-
df |>
filter(
cntry == "IE", essround == 8,
ess_day != '2017-04-17',
news == 'Yes',
!is.na(sblazy),
!is.na(sbprvpv),
!is.na(mnactic),
if(!is.null(time_window)){abs(dsp_daysafter) <= time_window} else TRUE
)
wt_dsp <- weightit(dsp_period ~ factor(gndr) + age_group + factor(mnactic),
data = df_dsp,
estimand = "ATE",
method = "ebal")
m_test <- glm_weightit(
formula = as.formula(paste0(outcome, " ~ ", treat_spec)),
family = 'quasibinomial', weightit = wt_dsp,  data = df_dsp
)
return(m_test)
}
get_wt_plot <- function(df, outcomes, treat_spec, time_windows){
df_out <-
map_dfr(outcomes, function(x){
map_dfr(time_windows, function(y){
broom::tidy(get_wt_model(df, outcome = x, treat_spec = treat_spec, time_window = y)) |>
mutate(variable = x, period = y)
})
})
return(df_out)
}
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 15, 7)
) |>  filter(term != '(Intercept)' & p.value < 0.05)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 15, 7)
) |>
ggplot(aes(y = term)) +
geom_pointrange(aes(x = estimate, xmin = estimate -1.96*std.error, xmax = estimate +1.96*std.error),
position = position_dodge(width = 0.4)) +
geom_vline(aes(xintercept = 0), color = '#f26a4c', linetype = 'dashed') +
theme_classic()
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 15, 7)
)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 15, 7)
) |>
ggplot(aes(y = term, fill = period)) +
geom_pointrange(aes(x = estimate, xmin = estimate -1.96*std.error, xmax = estimate +1.96*std.error),
position = position_dodge(width = 0.4)) +
geom_vline(aes(xintercept = 0), color = '#f26a4c', linetype = 'dashed') +
theme_classic() +
facet_wrap(~variable) +
labs(x = "Estimated effect of being interviewed\nafter the campaign launch", y = "", color = "Time-window: ", fill = "Time-window: ") +
theme(
axis.text.y = element_blank(),
legend.position = 'bottom'
)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('full', 15, 7)
) |>
ggplot(aes(y = term, color = period)) +
geom_pointrange(aes(x = estimate, xmin = estimate -1.96*std.error, xmax = estimate +1.96*std.error),
position = position_dodge(width = 0.4)) +
geom_vline(aes(xintercept = 0), color = '#f26a4c', linetype = 'dashed') +
theme_classic() +
facet_wrap(~variable) +
labs(x = "Estimated effect of being interviewed\nafter the campaign launch", y = "", color = "Time-window: ", fill = "Time-window: ") +
theme(
axis.text.y = element_blank(),
legend.position = 'bottom'
)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period*dsp_daysafter',
time_windows = c('full', 15, 7)
) |>
ggplot(aes(y = term, color = period)) +
geom_pointrange(aes(x = estimate, xmin = estimate -1.96*std.error, xmax = estimate +1.96*std.error),
position = position_dodge(width = 0.4)) +
geom_vline(aes(xintercept = 0), color = '#f26a4c', linetype = 'dashed') +
theme_classic() +
facet_wrap(~variable) +
labs(x = "Estimated effect of being interviewed\nafter the campaign launch", y = "", color = "Time-window: ", fill = "Time-window: ") +
theme(
axis.text.y = element_blank(),
legend.position = 'bottom'
)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period*dsp_daysafter',
time_windows = c('full', 15, 7)
) |>
ggplot(aes(y = term, color = period)) +
geom_pointrange(aes(x = estimate, xmin = estimate -1.96*std.error, xmax = estimate +1.96*std.error),
position = position_dodge(width = 0.4)) +
geom_vline(aes(xintercept = 0), color = '#f26a4c', linetype = 'dashed') +
theme_classic() +
facet_wrap(~variable) +
labs(x = "Estimated effect of being interviewed\nafter the campaign launch", y = "", color = "Time-window: ", fill = "Time-window: ") +
theme(
#axis.text.y = element_blank(),
legend.position = 'bottom'
)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period*dsp_daysafter',
time_windows = c(30, 15, 7)
) |>
ggplot(aes(y = term, color = period)) +
geom_pointrange(aes(x = estimate, xmin = estimate -1.96*std.error, xmax = estimate +1.96*std.error),
position = position_dodge(width = 0.4)) +
geom_vline(aes(xintercept = 0), color = '#f26a4c', linetype = 'dashed') +
theme_classic() +
facet_wrap(~variable) +
labs(x = "Estimated effect of being interviewed\nafter the campaign launch", y = "", color = "Time-window: ", fill = "Time-window: ") +
theme(
#axis.text.y = element_blank(),
legend.position = 'bottom'
)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period*dsp_daysafter',
time_windows = c('f', 30, 15, 7)
) |>
ggplot(aes(y = term, color = period)) +
geom_pointrange(aes(x = estimate, xmin = estimate -1.96*std.error, xmax = estimate +1.96*std.error),
position = position_dodge(width = 0.4)) +
geom_vline(aes(xintercept = 0), color = '#f26a4c', linetype = 'dashed') +
theme_classic() +
facet_wrap(~variable) +
labs(x = "Estimated effect of being interviewed\nafter the campaign launch", y = "", color = "Time-window: ", fill = "Time-window: ") +
theme(
#axis.text.y = element_blank(),
legend.position = 'bottom'
)
get_wt_plot(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('f', 30, 15, 7)
) |>
ggplot(aes(y = term, color = period)) +
geom_pointrange(aes(x = estimate, xmin = estimate -1.96*std.error, xmax = estimate +1.96*std.error),
position = position_dodge(width = 0.4)) +
geom_vline(aes(xintercept = 0), color = '#f26a4c', linetype = 'dashed') +
theme_classic() +
facet_wrap(~variable) +
labs(x = "Estimated effect of being interviewed\nafter the campaign launch", y = "", color = "Time-window: ", fill = "Time-window: ") +
theme(
#axis.text.y = element_blank(),
legend.position = 'bottom'
)
length(c('hi'))
length(c('hi', 'ho'))
length('ho')
length('holy')
get_wt_combined <- function(df, outcomes, treat_spec, time_windows){
df_dsp <-
df |>
filter(
cntry == "IE", essround == 8,
ess_day != '2017-04-17',
news == 'Yes',
!is.na(sblazy),
!is.na(sbprvpv),
!is.na(mnactic)
)
get_model <- function(outcome, time_window) {
if (!is.null(time_window)) {
df_dsp_filtered <- df_dsp |> filter(abs(dsp_daysafter) <= time_window)
} else {
df_dsp_filtered <- df_dsp
}
wt_dsp <- weightit(dsp_period ~ factor(gndr) + age_group + factor(mnactic),
data = df_dsp_filtered,
estimand = "ATE",
method = "ebal")
m_test <- glm_weightit(
formula = as.formula(paste0(outcome, " ~ ", treat_spec)),
family = 'quasibinomial', weightit = wt_dsp,  data = df_dsp_filtered
)
broom::tidy(m_test) |>
mutate(variable = outcome, period = time_window)
}
# Apply the model function across all outcomes and time windows
df_out <- map_dfr(outcomes, function(outcome) {
map_dfr(time_windows, function(time_window) {
get_model(outcome, time_window)
})
})
return(df_out)
}
get_wt_combined(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('f', 30, 15, 7)
)
get_wt_combined(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period',
time_windows = c('f', 30, 15, 7)
) |>
ggplot(aes(y = term, color = period)) +
geom_pointrange(aes(x = estimate, xmin = estimate -1.96*std.error, xmax = estimate +1.96*std.error),
position = position_dodge(width = 0.4)) +
geom_vline(aes(xintercept = 0), color = '#f26a4c', linetype = 'dashed') +
theme_classic() +
facet_wrap(~variable) +
labs(x = "Estimated effect of being interviewed\nafter the campaign launch", y = "", color = "Time-window: ", fill = "Time-window: ") +
theme(
#axis.text.y = element_blank(),
legend.position = 'bottom'
)
# Example of how to use the new function
get_wt_combined(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period*dsp_daysafter',
time_windows = c('f', 30, 15, 7)) |>
ggplot(aes(y = term, color = period)) +
geom_pointrange(aes(x = estimate, xmin = estimate -1.96*std.error, xmax = estimate +1.96*std.error),
position = position_dodge(width = 0.4)) +
geom_vline(aes(xintercept = 0), color = '#f26a4c', linetype = 'dashed') +
theme_classic() +
facet_wrap(~variable) +
labs(x = "Estimated effect of being interviewed\nafter the campaign launch", y = "", color = "Time-window: ", fill = "Time-window: ") +
theme(
#axis.text.y = element_blank(),
legend.position = 'bottom'
)
get_wt_combined <- function(df, outcomes, treat_spec, time_windows){
df_dsp <-
df |>
filter(
cntry == "IE", essround == 8,
ess_day != '2017-04-17',
news == 'Yes',
!is.na(sblazy),
!is.na(sbprvpv),
!is.na(mnactic)
)
get_model <- function(outcome, time_window) {
if (!is.null(time_window)) {
df_dsp_filtered <- df_dsp |> filter(abs(dsp_daysafter) <= time_window)
} else {
df_dsp_filtered <- df_dsp
}
wt_dsp <- weightit(dsp_period ~ factor(gndr) + age_group + factor(mnactic),
data = df_dsp_filtered,
estimand = "ATT",
method = "ebal")
m_test <- glm_weightit(
formula = as.formula(paste0(outcome, " ~ ", treat_spec)),
family = 'quasibinomial', weightit = wt_dsp,  data = df_dsp_filtered
)
broom::tidy(m_test) |>
mutate(variable = outcome, period = time_window)
}
# Apply the model function across all outcomes and time windows
df_out <- map_dfr(outcomes, function(outcome) {
map_dfr(time_windows, function(time_window) {
get_model(outcome, time_window)
})
})
return(df_out)
}
# Example of how to use the new function
get_wt_combined(
df = df_ess,
outcomes = c('sbprvpv_agree', 'sblazy_agree', 'gincdif_agree'),
treat_spec = 'dsp_period*dsp_daysafter',
time_windows = c('f', 30, 15, 7)) |>
ggplot(aes(y = term, color = period)) +
geom_pointrange(aes(x = estimate, xmin = estimate -1.96*std.error, xmax = estimate +1.96*std.error),
position = position_dodge(width = 0.4)) +
geom_vline(aes(xintercept = 0), color = '#f26a4c', linetype = 'dashed') +
theme_classic() +
facet_wrap(~variable) +
labs(x = "Estimated effect of being interviewed\nafter the campaign launch", y = "", color = "Time-window: ", fill = "Time-window: ") +
theme(
#axis.text.y = element_blank(),
legend.position = 'bottom'
)
